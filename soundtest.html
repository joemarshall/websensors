<html>


<head>


    <script>
        function setLog(logDiv)
        {
            let getLineFromStack=function(stack) 
            {
                var suffix = stack.split('\n')[2];
                if(suffix)
                {
                    if (suffix.indexOf(' (') >= 0) {
                        suffix = suffix.split(' (')[1].substring(0, suffix.length - 1);
                    }
                    else if(suffix.indexOf('at ')>=0){
                        suffix = suffix.split('at ')[1];
                    }else if(suffix.indexOf('@')>=0)
                    {
                        suffix=suffix.split('@')[1];                
                    }
                    if(suffix)
                    {
                        if(suffix.lastIndexOf('/')>=0)
                        {
                            suffix = '@' + suffix.substr(suffix.lastIndexOf('/') + 1);
                        }
                    }
                }
                if(!suffix)
                {
                    return "@ wasm";
                }
                return suffix;
            };
            let getCallerLineNumber=function(err)
            {
                var line;
        
                // Firefox
                if (err.fileName && err.lineNumber) {
                    line=err.fileName.substr(err.fileName.lastIndexOf('/') + 1) + ':' + err.lineNumber + ':1';
                }
                // Chrome/WebKit
                else if (err.stack) {
                    line=getLineFromStack(err.stack);
                }
                return line;
        
            };
            let addLog=function (arguments, array) {
                var s="";
                for(let i in arguments)
                {
                    s+=arguments[i]+" ";
                }
                s+="\n";
                logDiv.prepend(document.createTextNode(s));
            };
        
        
        
            let origConsole=window.console;
            let isDebug=true;
            if(!origConsole)
            {
                origConsole=console;
            }
            var logger={
                logArray:[],
                log: function (...theArgs) {
                    theArgs.push(getCallerLineNumber(new Error()));            
                    addLog(theArgs, "logs");
                    isDebug && origConsole.log && origConsole.log.apply(origConsole, theArgs);
                },
                warn: function (...theArgs) {
                    theArgs.push(getCallerLineNumber(new Error()));            
                    addLog(theArgs, "warns");
                    isDebug && origConsole.warn && origConsole.warn.apply(origConsole,theArgs);
                },
                error: function (...theArgs) {
                    theArgs.push(getCallerLineNumber(new Error()));            
                    addLog(theArgs, "errors");
                    isDebug && origConsole.error && origConsole.error.apply(origConsole, theArgs);
                },
                info: function (...theArgs) {
                    theArgs.push(getCallerLineNumber(new Error()));            
                    addLog(theArgs, "infos");
                    isDebug && origConsole.info && origConsole.info.apply(origConsole, theArgs);
                },
                debug: function (debugEnabled) {
                    isDebug = debugEnabled;
                },
        
        
          
            };
            window.console=logger;    
        }
        
        
        </script>
        

</head>


<body onload="setLog(document.getElementById('LOGDIV'))"></body>
<button id="init">ASKPERMISSIONS</button>
<button id="start">START</button>
<button id="stop">STOP</button>

<pre id="LOGDIV">
LOGS ARE HERE

</pre>


<script type="module">

    import { requestPermissions, start,stop } from './assets/js/sound_sensor.js';

    window.addEventListener("load",()=>
    {
        console.log("Module event");
    });
    console.log("IMPORTED OK");
    
    function callbackFn(level)
    {
        var textNode=document.createTextNode(level+"\n");
        document.getElementById("LOGDIV").prepend(textNode);
    }
    

    document.getElementById("init").addEventListener("click",()=>{console.log("init");requestPermissions()});
    document.getElementById("start").addEventListener("click",()=>{console.log("start");start(callbackFn)});
    document.getElementById("stop").addEventListener("click",()=>{console.log("stop");stop()});

    window.onerror=function(...args){console.error("ERR",args);};
    </script>
    
<body>
    ]
</body>
</html>