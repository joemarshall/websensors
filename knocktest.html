---
title: Knocktest 1 - front matter to make it build with jekyll
---
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, user_scalable=no" />
<style>
        #canvas {
            margin-left: auto;
            margin-right: auto;
            width:90vw;
            display: block;
            background-color: black;
            height: 25vh;
        }
        #consoleDiv {
            margin-left: auto;
            margin-right: auto;
            display: block;
            background-color: white;
            width:90vw;
            height:50vh;
            overflow-y: scroll; 
            font-family:monospace;
            white-space:pre;
        }
        #buttonDiv
        {
            margin-left: auto;
            margin-right: auto;
            width:90vw;
            display: block;
            padding:0;
        }
        #startButton,#runPython
        {
            width:45%;height:5vh;margin-left:2%;margin-right:2%;padding:0;
        }
</style>
<script>
window.languagePluginUrl="./pyodide/";
</script>

<script src="pyodide/pyodide.js" language="javascript"></script>
<script language="javascript">
// because we use mic and accelerometer, we only work from https pages
if ( location.protocol != "https:" ) {
location.href = "https:" + window.location.href.substring( window.location.protocol.length );
}
</script>

<script src="audioworklet-polyfill.js"></script>
<script type="module">

async function initFn()
{
    // reload any script files that have updated since last reload    
    // this is the github checkin we're looking at
    let currentRevision="{{ site.github.build_revision }}";
    const lastRevision=localStorage.getItem('lastRevision');
    if (lastRevision && lastRevision!=currentRevision)
    {
        let updatePromiseList=[];
        let compareURL="{{site.github.api_url}}/repos/{{site.github.owner_name}}/{{site.github.repository_name}}/compare/"+lastRevision+"..."+currentRevision;
        let compareJSON=await (await fetch(compareURL)).json();
        for(let i in compareJSON.files)
        {
            let fname=compareJSON.files[i].filename;
            if(fname.endsWith(".js") || fname.endsWith(".py"))
            {
                console.log("Updating:",fname);
                updatePromiseList.push(fetch(fname,{cache:"no-cache"}));
            }
        }
        await Promise.all(updatePromiseList);
        localStorage.setItem('lastRevision',currentRevision);
    }        
    
    await languagePluginLoader;
    let cons=await import("./console_override.js");
    let loaders=await import("./pyodide_loaders.js");
    // need to request permissions on ios right when the button is clicked so 
    // we do it here rather than via python
    let mod_accel=await import("./accel_sensor.js");
    let accel_request_permissions=mod_accel.requestPermissions;
    cons.setConsoleDiv(document.getElementById("consoleDiv"));
    
    
    let sensors=await loaders.loadAsModule("sensors","sensors.py");
    await loaders.loadAsModule("print_pyodide","print_pyodide.py");
    await loaders.loadAsModule("async_pyodide","async_pyodide.py");
    await loaders.loadAsModule("graphs","graphs.py");
    pyodide.runPython("import graphs")
    pyodide.globals.graphs.setCanvas(document.getElementById("canvas"))
    document.getElementById("runPython").addEventListener('click',async () => {await loaders.runScriptFromFile("knocktest1.py");})
    document.getElementById("startButton").addEventListener('click',async function (evt){
        await accel_request_permissions();
        sensors.startAll();
        });
    document.getElementById("runPython").disabled=false;
    document.getElementById("startButton").disabled=false;
    console.log("Python initialized");
}

window.addEventListener('load',initFn);

</script>
</head>
<body>
<canvas id="canvas" width="512" height="256" ></canvas>
<div id="buttonDiv">
<button id="startButton" disabled>Start Sensors</button>
<button id="runPython" disabled> Run Python test</button>
</div>
<div id="consoleDiv" >
Loading...
</div>
</body>
</html>